<!DOCTYPE html>
<html lang="de">
	<head>
		<meta charset="utf-8">
		<title>Test Suite - Compute</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<style type="text/css">
		.measures {
			margin-bottom: 5px;
			border: 1px solid #333;
			background-color: #f3f3f3;
		}
		.measures > table {
			width: 100%;
			table-layout: fixed;
		}

		.measures > table td {
			text-align: center;
		}

		.measures > table td:first-child {
			width: 200px;
			overflow: hidden;
			text-align: left;
		}
		</style>
	</head>
	<body onload="init()">
		<div class="measures">
			<table id="measureTable">
				<tr>
					<th>Name</th>
					<th>Entry Type</th>
					<th>Start Time</th>
					<th>Duration</th>
				</tr>
			</table>
		</div>

		<div class="measures">
			<table id="resourceTable">
				<tr>
					<th>Name</th>
					<th>Redirect Start</th>
					<th>Redirect End</th>
					<th>fetchStart</th>
					<th>Domain Lookup Start</th>
					<th>Domain Lookup End</th>
					<th>Connect Start</th>
					<th>Connect End</th>
					<th>Secure Connection Start</th>
					<th>Request Start</th>
					<th>Response Start</th>
					<th>Response End</th>
				</tr>
			</table>
		</div>
		<img id="image0" src="http://w3c-test.org/webperf/image0.png" />
		<img id="image1" src="http://w3c-test.org/webperf/image1.png" />
		<img id="image2" src="images/performance_image.png" />


		<script>
			function init() {
				performance.mark("test 1");

				wait(function() {
					performance.mark("test 2");
					performance.measure("test 1 - test 2", "test 1", "test 2");
					measurePerf();
				});

			}

			function wait(callback) {
				setTimeout(function() { callback() }, 1000);
			}

			function measurePerf() {
				var perfEntries = performance.getEntries();
				var measureTable = document.getElementById("measureTable");
				var resourceTable = document.getElementById("resourceTable");

				var addTableRow = function(table, elements) {
					var tr = document.createElement("tr");
					elements.forEach(function(item) {
						var td = document.createElement('td');

						if (typeof item == "number") {
							item = item.toFixed(2);
						}
						td.appendChild(document.createTextNode(item));
						tr.appendChild(td);
					});
					table.appendChild(tr);
				}

				for (var i = 0; i < perfEntries.length; i++) {

					var name = perfEntries[i].name.match(/\w+\.png$/);
					var name = name ? name[0] : perfEntries[i].name;

					var defaultElements = [name, perfEntries[i].entryType, perfEntries[i].startTime, perfEntries[i].duration];
					addTableRow(measureTable, defaultElements);

					if (perfEntries[i].entryType == "resource") {
						var resourceTimingElements = [name, perfEntries[i].redirectStart, perfEntries[i].redirectEnd,
							perfEntries[i].fetchStart, perfEntries[i].domainLookupStart, , perfEntries[i].domainLookupEnd,
							perfEntries[i].connectStart, perfEntries[i].connectEnd, perfEntries[i].secureConnectionStart,
							perfEntries[i].requestStart, perfEntries[i].responseStart, perfEntries[i].responseEnd];

						addTableRow(resourceTable, resourceTimingElements);
					}
				}
			}
		</script>
	</body>
</html>